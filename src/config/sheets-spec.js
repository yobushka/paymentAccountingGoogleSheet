/**
 * @fileoverview Спецификация структуры листов для v2.0
 * Определяет заголовки, ширины колонок и колонки с датами для каждого листа
 */

/**
 * Возвращает спецификацию всех листов приложения
 * @returns {Array<{name: string, headers: string[], colWidths: number[], dateCols?: number[]}>}
 */
function getSheetsSpec() {
  return [
    {
      name: SHEET_NAMES.INSTRUCTION,
      headers: ['Шаг', 'Описание'],
      colWidths: [80, 1000]
    },
    {
      name: SHEET_NAMES.FAMILIES,
      headers: [
        'Ребёнок ФИО', 'Пол', 'День рождения',
        'Мама ФИО', 'Мама телефон', 'Мама реквизиты', 'Мама телеграм',
        'Папа ФИО', 'Папа телефон', 'Папа реквизиты', 'Папа телеграм',
        'Активен', 'Членство с', 'Членство по', 'Комментарий',
        'family_id'
      ],
      colWidths: [220, 60, 110, 220, 140, 240, 160, 220, 140, 240, 160, 90, 110, 110, 260, 110],
      dateCols: [3, 13, 14]  // День рождения, Членство с, Членство по (сдвинуты на 1)
    },
    {
      // v2.0: Цели вместо Сборы
      name: SHEET_NAMES.GOALS,
      headers: [
        'Название цели', 'Тип', 'Статус',
        'Дата начала', 'Дедлайн',
        'Начисление', 'Параметр суммы', 'Фиксированный x', 'К выдаче детям',
        'Периодичность', 'Родительская цель',
        'Закупка из средств', 'Возмещено',
        'Комментарий',
        'goal_id', 'Ссылка на гуглдиск'
      ],
      colWidths: [260, 120, 120, 110, 110, 220, 150, 140, 150, 140, 140, 200, 110, 260, 120, 300],
      dateCols: [4, 5]
    },
    {
      // v1.x legacy: Сборы (для миграции)
      name: SHEET_NAMES.COLLECTIONS,
      headers: [
        'Название сбора', 'Статус',
        'Дата начала', 'Дедлайн',
        'Начисление', 'Параметр суммы', 'Фиксированный x', 'К выдаче детям',
        'Закупка из средств', 'Возмещено',
        'Комментарий',
        'collection_id', 'Ссылка на гуглдиск'
      ],
      colWidths: [260, 120, 110, 110, 220, 150, 140, 150, 200, 110, 260, 120, 300],
      dateCols: [3, 4]
    },
    {
      name: SHEET_NAMES.ISSUES,
      headers: [
        'Дата выдачи', 'goal_id (label)', 'family_id (label)', 'Единиц', 'Кто выдал', 'Выдано', 'Комментарий'
      ],
      colWidths: [110, 260, 260, 90, 160, 110, 260],
      dateCols: [1]
    },
    {
      name: SHEET_NAMES.ISSUE_STATUS,
      headers: [
        'goal_id', 'Название', 'Статус', 'x (цена)', 'Единиц требуется', 'Единиц оплачено', 'Единиц выдано', 'Остаток (шт)'
      ],
      colWidths: [120, 260, 110, 110, 140, 140, 140, 130]
    },
    {
      name: SHEET_NAMES.PARTICIPATION,
      headers: ['goal_id (label)', 'family_id (label)', 'Статус', 'Комментарий'],
      colWidths: [260, 260, 120, 260]
    },
    {
      name: SHEET_NAMES.PAYMENTS,
      headers: [
        'Дата', 'family_id (label)', 'goal_id (label)',
        'Сумма', 'Способ', 'Комментарий', 'payment_id'
      ],
      colWidths: [110, 260, 260, 110, 110, 260, 120],
      dateCols: [1]
    },
    {
      // v2.0: расширенный баланс
      name: SHEET_NAMES.BALANCE,
      headers: [
        'family_id', 'Имя ребёнка',
        'Внесено всего', 'Списано всего', 'Зарезервировано',
        'Свободный остаток', 'Задолженность'
      ],
      colWidths: [120, 260, 140, 140, 150, 160, 130]
    },
    {
      name: SHEET_NAMES.DETAIL,
      headers: [
        'family_id', 'Имя ребёнка', 'goal_id', 'Название цели',
        'Оплачено', 'Начислено', 'Разность (±)', 'Режим'
      ],
      colWidths: [120, 200, 120, 200, 120, 120, 120, 150]
    },
    {
      name: SHEET_NAMES.SUMMARY,
      headers: [
        'goal_id', 'Название цели', 'Режим', 'Сумма цели', 'Собрано', 'Участников', 'Плательщиков', 'Единиц оплачено', 'Ещё плательщиков до закрытия', 'Остаток до цели', 'Переплата'
      ],
      colWidths: [120, 260, 180, 140, 140, 120, 150, 150, 220, 150, 130]
    },
    {
      name: SHEET_NAMES.LISTS, // скрытый служебный лист
      headers: [
        'OPEN_GOALS', '',
        'GOALS', '',
        'ACTIVE_FAMILIES', '',
        'FAMILIES', ''
      ],
      colWidths: [260, 40, 260, 40, 260, 40, 260, 40]
    }
  ];
}

/**
 * Возвращает спецификацию для v1.x (legacy) — для миграции
 * @returns {Array<{name: string, headers: string[], colWidths: number[], dateCols?: number[]}>}
 */
function getSheetsSpecV1() {
  return [
    {
      name: 'Инструкция',
      headers: ['Шаг', 'Описание'],
      colWidths: [80, 1000]
    },
    {
      name: 'Семьи',
      headers: [
        'Ребёнок ФИО', 'День рождения',
        'Мама ФИО', 'Мама телефон', 'Мама реквизиты', 'Мама телеграм',
        'Папа ФИО', 'Папа телефон', 'Папа реквизиты', 'Папа телеграм',
        'Активен', 'Комментарий',
        'family_id'
      ],
      colWidths: [220, 110, 220, 140, 240, 160, 220, 140, 240, 160, 90, 260, 110],
      dateCols: [2]
    },
    {
      name: 'Сборы',
      headers: [
        'Название сбора', 'Статус',
        'Дата начала', 'Дедлайн',
        'Начисление', 'Параметр суммы', 'Фиксированный x', 'К выдаче детям',
        'Закупка из средств', 'Возмещено',
        'Комментарий',
        'collection_id', 'Ссылка на гуглдиск'
      ],
      colWidths: [260, 120, 110, 110, 220, 150, 140, 150, 200, 110, 260, 120, 300],
      dateCols: [3, 4]
    },
    {
      name: 'Выдача',
      headers: [
        'Дата выдачи', 'collection_id (label)', 'family_id (label)', 'Единиц', 'Кто выдал', 'Выдано', 'Комментарий'
      ],
      colWidths: [110, 260, 260, 90, 160, 110, 260],
      dateCols: [1]
    },
    {
      name: 'Статус выдачи',
      headers: [
        'collection_id', 'Название', 'Статус', 'x (цена)', 'Единиц требуется', 'Единиц оплачено', 'Единиц выдано', 'Остаток (шт)'
      ],
      colWidths: [120, 260, 110, 110, 140, 140, 140, 130]
    },
    {
      name: 'Участие',
      headers: ['collection_id (label)', 'family_id (label)', 'Статус', 'Комментарий'],
      colWidths: [260, 260, 120, 260]
    },
    {
      name: 'Платежи',
      headers: [
        'Дата', 'family_id (label)', 'collection_id (label)',
        'Сумма', 'Способ', 'Комментарий', 'payment_id'
      ],
      colWidths: [110, 260, 260, 110, 110, 260, 120],
      dateCols: [1]
    },
    {
      name: 'Баланс',
      headers: [
        'family_id', 'Имя ребёнка',
        'Переплата (текущая)', 'Оплачено всего', 'Начислено всего', 'Задолженность'
      ],
      colWidths: [120, 260, 140, 140, 120, 130]
    },
    {
      name: 'Детализация',
      headers: [
        'family_id', 'Имя ребёнка', 'collection_id', 'Название сбора',
        'Оплачено', 'Начислено', 'Разность (±)', 'Режим'
      ],
      colWidths: [120, 200, 120, 200, 120, 120, 120, 150]
    },
    {
      name: 'Сводка',
      headers: [
        'collection_id', 'Название сбора', 'Режим', 'Сумма цели', 'Собрано', 'Участников', 'Плательщиков', 'Единиц оплачено', 'Ещё плательщиков до закрытия', 'Остаток до цели'
      ],
      colWidths: [120, 260, 180, 140, 140, 120, 150, 150, 220, 150]
    },
    {
      name: 'Lists',
      headers: [
        'OPEN_COLLECTIONS', '',
        'COLLECTIONS', '',
        'ACTIVE_FAMILIES', '',
        'FAMILIES', ''
      ],
      colWidths: [260, 40, 260, 40, 260, 40, 260, 40]
    }
  ];
}
